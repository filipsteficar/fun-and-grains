---
// Layouts
import Layout from "../../layouts/Layout.astro";
// Components
import PageTitle from "../../components/PageTitle.astro";
import BlogCard from "../../components/BlogCard.astro";
// Data Imports
import { siteData } from "../../global";
// Directus Imports
import directus from "../../lib/directus";
import { readItems } from "@directus/sdk";
// Query Posts from Directus
const posts = await directus.request(
    readItems("posts", {
        fields: [
            "id",
            "title",
            "slug",
            "cover",
            "date_created",
            "status",
            {
                author: ["id", "name", "slug"]
            }
        ],
        filter: {
            status: {
                _eq: "published"
        }
    },
    sort: ["-date_created"],
    limit: -1,
    })
);
// Directus URL
const CMS = "https://directus-v0gswo0csw84sck0cc8c4oo0.apollo.filipsteficar.com";
---
<Layout pageTitle=`Blog - ${siteData.name}`>
    <PageTitle pageTitle="Blog" />
    <section class="@container">
        <div class="gap-4 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 mx-auto mt-4 px-4 container">
            {posts.map((singlePost) => (
                <BlogCard
                imgSRC={`${CMS}/assets/${singlePost.cover}?width=1200&quality=80&format=webp`}
                title={singlePost.title}
                author={singlePost.author?.name || "Unknown Author"}
                date={new Date(singlePost.date_created).toLocaleDateString('en-GB')}
                href={`/blog/${singlePost.slug}`}
                />
            ))}
        </div>
    </section>
</Layout>